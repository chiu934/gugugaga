
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Avatar Lip‑Sync (RMS → jawOpen)</title>
  <style>
    body { margin: 0; height:100vh; display:grid; place-items:center; background:#0b0b12; color:#fff; font-family: system-ui; }
    .wrap { text-align:center; }
    .face { width: 160px; height: 160px; background:#1c1f2a; border-radius: 50%; display:grid; place-items:center; box-shadow: 0 10px 30px #0008; }
    .mouth { width: 60px; background:#e25555; border-radius: 12px; transition: height 60ms linear; }
    .val { margin-top: 16px; font-size: 14px; opacity: .8; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="face">
      <div id="mouth" class="mouth" style="height: 8px;"></div>
    </div>
    <div id="val" class="val">jawOpen: 0.00</div>
  </div>
  <script type="module">
    const val = document.getElementById('val');
    const mouth = document.getElementById('mouth');
    const ws = new WebSocket('ws://localhost:7071');

    let jawOpen = 0;
    function smooth(current, target, a=0.25) { return current + (target - current) * a; }

    ws.onmessage = (evt) => {
      const msg = JSON.parse(evt.data);
      if (msg.type === 'viseme') {
        const target = Math.min(1, Math.max(0, msg.rms));
        jawOpen = smooth(jawOpen, target);
        const h = 8 + jawOpen * 70; // 8..78px
        mouth.style.height = h + 'px';
        val.textContent = 'jawOpen: ' + jawOpen.toFixed(2);
      }
    };
  </script>
</body>
</html>
